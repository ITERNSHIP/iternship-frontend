<template>
  <div>
    <StudentNavBar />
    <div
      class="bg-slate-200 min-h-screen flex flex-col items-center justify-center"
    >
      <div
        class="flex flex-col bg-white shadow-md px-4 sm:px-6 md:px-8 lg:px-10 py-8 rounded-xl w-full max-w-3xl my-8"
      >
        <div
          class="font-medium self-center text-xl sm:text-2xl uppercase text-gray-800"
        >
          ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô
        </div>
        <div class="mt-10">
          <form action="#" @submit.prevent="onSubmit">
            <div class="space-y-1 mb-2">
              <span>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</span>
              <input
                v-model.trim.lazy="$v.fullName.$model"
                type="text"
                placeholder=""
                class="text-sm sm:text-base placeholder-gray-500 pl-10 pr-4 rounded-xl border border-gray-400 w-full py-2 focus:outline-none focus:border-blue-400"
              />
              <p
                v-if="!$v.fullName.required && $v.fullName.$dirty"
                class="text-error mt-2 text-sm"
              >
                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•
              </p>
            </div>
            <div class="space-y-1 mb-2">
              <span>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</span>
              <input
                v-model.trim.lazy="$v.studentId.$model"
                type="number"
                placeholder=""
                class="text-sm sm:text-base placeholder-gray-500 pl-10 pr-4 rounded-xl border border-gray-400 w-full py-2 focus:outline-none focus:border-blue-400"
              />
              <p
                v-if="!$v.studentId.required && $v.studentId.$dirty"
                class="text-error mt-2 text-sm"
              >
                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤
              </p>

              <p
                v-if="!$v.studentId.numeric && $v.studentId.$dirty"
                class="text-error mt-2 text-sm"
              >
                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
              </p>

              <p
                v-if="!$v.studentId.minLength && $v.studentId.$dirty"
                class="text-error mt-2 text-sm"
              >
                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
              </p>

              <p
                v-if="!$v.studentId.maxLength && $v.studentId.$dirty"
                class="text-error mt-2 text-sm"
              >
                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
              </p>
            </div>

            <div class="space-y-1 mb-2">
              <span>‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤</span>
              <select
                v-model.trim.lazy="$v.faculty.$model"
                class="text-sm sm:text-base placeholder-gray-500 pl-10 pr-4 rounded-xl border border-gray-400 w-full py-2 focus:outline-none focus:border-blue-400"
              >
                <option value="‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®">‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®</option>
                <option value="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</option>
                <option value="‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡∏¥‡∏à‡∏¥‡∏ï‡∏≠‡∏•">
                  ‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡∏¥‡∏à‡∏¥‡∏ï‡∏≠‡∏•
                </option>
              </select>
              <p
                v-if="!$v.faculty.required && $v.faculty.$dirty"
                class="text-error mt-2 text-sm"
              >
                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤
              </p>
            </div>

            <div class="space-y-1 mb-2">
              <span>‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</span>
              <select
                v-model.trim.lazy="$v.year.$model"
                class="text-sm sm:text-base placeholder-gray-500 pl-10 pr-4 rounded-xl border border-gray-400 w-full py-2 focus:outline-none focus:border-blue-400"
              >
                <option value="2562">2562</option>
                <option value="2563">2563</option>
                <option value="2564">2564</option>
                <option value="2565">2565</option>
              </select>
              <p
                v-if="!$v.year.required && $v.year.$dirty"
                class="text-error mt-2 text-sm"
              >
                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤
              </p>
            </div>

            <div class="space-y-1 mb-2">
              <span>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÑ‡∏õ‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô</span>
              <input
                v-model.trim.lazy="$v.companyName.$model"
                type="text"
                placeholder=""
                class="text-sm sm:text-base placeholder-gray-500 pl-10 pr-4 rounded-xl border border-gray-400 w-full py-2 focus:outline-none focus:border-blue-400"
              />
              <p
                v-if="!$v.companyName.required && $v.companyName.$dirty"
                class="text-error mt-2 text-sm"
              >
                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
              </p>
            </div>

            <div class="space-y-1 mb-2">
              <span>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÑ‡∏õ‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô</span>
              <input
                v-model.trim.lazy="$v.position.$model"
                type="text"
                placeholder=""
                class="text-sm sm:text-base placeholder-gray-500 pl-10 pr-4 rounded-xl border border-gray-400 w-full py-2 focus:outline-none focus:border-blue-400"
              />
              <p
                v-if="!$v.position.required && $v.position.$dirty"
                class="text-error mt-2 text-sm"
              >
                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô
              </p>
            </div>

            <div class="space-y-1 mb-2">
              <span>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</span>
              <select
                v-model.trim.lazy="$v.longTerm.$model"
                class="text-sm sm:text-base placeholder-gray-500 pl-10 pr-4 rounded-xl border border-gray-400 w-full py-2 focus:outline-none focus:border-blue-400"
              >
                <option value="2 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô">2 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
                <option value="4 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô">4 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
                <option value="6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô">6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
              </select>
              <p
                v-if="!$v.longTerm.required && $v.longTerm.$dirty"
                class="text-error mt-2 text-sm"
              >
                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô
              </p>
            </div>

            <div class="space-y-1 mb-2">
              <span>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô</span>
              <input
                v-model.trim.lazy="$v.startMonth.$model"
                type="date"
                placeholder=""
                class="text-sm sm:text-base placeholder-gray-500 pl-10 pr-4 rounded-xl border border-gray-400 w-full py-2 focus:outline-none focus:border-blue-400"
              />
              <p
                v-if="!$v.startMonth.required && $v.startMonth.$dirty"
                class="text-error mt-2 text-sm"
              >
                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô
              </p>
            </div>

            <div class="space-y-1 mb-2">
              <span>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏ö‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô</span>
              <input
                v-model.trim.lazy="$v.endMonth.$model"
                type="date"
                placeholder=""
                class="text-sm sm:text-base placeholder-gray-500 pl-10 pr-4 rounded-xl border border-gray-400 w-full py-2 focus:outline-none focus:border-blue-400"
              />
              <p
                v-if="!$v.endMonth.required && $v.endMonth.$dirty"
                class="text-error mt-2 text-sm"
              >
                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏ö‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô
              </p>
            </div>

            <div class="flex w-full mt-8">
              <button
                type="submit"
                class="flex items-center justify-center focus:outline-none text-white text-sm sm:text-base bg-blue-600 hover:bg-blue-700 rounded-xl py-2 w-full transition duration-150 ease-in"
              >
                <span class="mr-2 uppercase">‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import {
  required,
  numeric,
  minLength,
  maxLength,
} from 'vuelidate/lib/validators'
import StudentNavBar from '~/components/StudentNavBar.vue'
import dayjs from 'dayjs'
import Footer from '~/components/Footer.vue'
export default {
  components: { StudentNavBar, Footer },

  data() {
    return {
      // confirmedForm: {
      //   fName: '',
      //   lName: '',
      //   studentId: '',
      //   companyName: '',
      //   position: '',
      //   durationForm: '',
      //   durationTo: '',
      //   longTerm:'',
      //   user: {
      //     userId: `${localStorage.getItem('userId')}`,
      //   },
      // },
      fullName: '',
      studentId: '',
      companyName: '',
      year: '',
      faculty: '',
      position: '',
      startMonth: '',
      endMonth: '',
      longTerm: '',
    }
  },

  async mounted() {
    // console.log('ftfftutufjtfgtfjgjjtftj')
    const accessToken = localStorage.getItem('accessToken')
    if(!accessToken){
      this.$router.push('/login')
    }
    const newData = this.$store.state.studentData
    this.fullName = newData.fullName
    this.studentId = newData.userId
    this.faculty = newData.faculty
    this.year = newData.year
  },
  computed: {
    getStudentData() {
      return this.$store.state.studentData
    },
    getLenghthMonth() {
      let startMonth = this.startMonth
      let longterm = this.longTerm
      let data = {
        startMonth,
        longterm,
      }
      return data
    },
  },

  watch: {
    getStudentData(newData) {
      this.fullName = newData.fullName
      this.studentId = newData.userId
      this.faculty = newData.faculty
      this.year = newData.year
    },
    getLenghthMonth(newData) {
      if (newData.longterm && newData.startMonth) {
        this.calculateMonth(newData.longterm, newData.startMonth)
      } else {
        this.endMonth = ''
      }
    },
  },

  methods: {
    calculateMonth(howLong, startDate) {
      let currentDate = new Date(startDate)
      if (howLong == '2 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô') {
        currentDate.setMonth(currentDate.getMonth() + 2)
        currentDate = dayjs(currentDate).format('YYYY-MM-DD')
        this.endMonth = currentDate
      } else if (howLong == '4 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô') {
        currentDate.setMonth(currentDate.getMonth() + 4)
        currentDate = dayjs(currentDate).format('YYYY-MM-DD')
        this.endMonth = currentDate
      } else {
        currentDate.setMonth(currentDate.getMonth() + 6)
        currentDate = dayjs(currentDate).format('YYYY-MM-DD')
        this.endMonth = currentDate
      }
    },
    onSubmit() {
      this.$v.$touch()
      if (this.$v.$invalid) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô')
        // console.log(this.sentInternshipForm)
        return
      }
      this.sentconfirmedForm()
    },
    async sentconfirmedForm() {
      const data = {
        fullName: this.fullName,
        studentId: this.studentId,
        companyName: this.companyName,
        year: this.year,
        faculty: this.faculty,
        position: this.position,
        durationForm: this.startMonth,
        durationTo: this.endMonth,
        longTerm: this.longTerm,
        user: {
          userId: `${localStorage.getItem('userId')}`,
        },
      }
      console.log(
        'üöÄ ~ file: confirmed.vue ~ line 293 ~ sentconfirmedForm ~ data',
        data
      )
      // await this.$axios.$post(`/users/createconfirmationForm`, data, {
      //   headers: {
      //     Authorization: `Bearer ${localStorage.getItem('accessToken')}`,
      //   },
      // })
      // alert('‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à')
      // this.$router.push('/student')
      // location.reload('/student')
      // const data = this.confirmedForm
      await this.$axios
        .$post(`/users/createconfirmationForm`, data, {
          headers: {
            Authorization: `Bearer ${localStorage.getItem('accessToken')}`,
          },
        })
        .then((res) => {
          // alert('‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à')
          this.$swal({
            title: '‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
            icon: 'success',
            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
          }).then((result) => {
            if (result.isConfirmed) {
              this.$router.push('/student')
              // location.reload('/student')
            }
          })
          // location.reload()
        })
        .catch((err) => {})
    },
  },

  validations: {
    fullName: {
      required,
    },
    studentId: {
      required,
      numeric,
      minLength: minLength(11),
      maxLength: maxLength(11),
    },
    companyName: {
      required,
    },
    position: {
      required,
    },
    startMonth: {
      required,
    },
    endMonth: {
      required,
    },
    longTerm: {
      required,
    },
    year: {
      required,
    },
    faculty: {
      required,
    },
  },
}
</script>

<style>
/* Chrome, Safari, Edge, Opera */
input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

/* Firefox */
input[type='number'] {
  -moz-appearance: textfield;
}
</style>
